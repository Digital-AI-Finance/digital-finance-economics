<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>A6: How AMMs Set Prices — The Constant Product Formula — Digital Finance & Economics</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false}]});});</script>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;background:#f6f8fa;color:#24292e;font-size:13px;line-height:1.6}a{color:#0366d6;text-decoration:none}a:hover{text-decoration:underline}.nav{background:#24292e;padding:8px 16px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}.nav-title{color:#fff;font-weight:600;font-size:15px}.nav-links{display:flex;gap:20px}.nav-links a{color:#fff;font-size:12px;opacity:0.85;transition:opacity 0.15s}.nav-links a:hover{opacity:1;text-decoration:none}.container{max-width:1000px;margin:0 auto;padding:20px}.assignment-header{color:#fff;padding:24px 32px;border-radius:6px;margin-bottom:20px}.assignment-header h1{font-size:22px;font-weight:700;margin-bottom:4px}.assignment-header .lecture-ref{font-size:13px;opacity:0.85}.section-title{font-size:16px;font-weight:700;margin:24px 0 12px;padding-bottom:6px;border-bottom:2px solid #e1e4e8}.brief-content{background:#fff;border:1px solid #e1e4e8;border-radius:6px;padding:20px;margin-bottom:20px}.brief-content h2{font-size:16px;font-weight:700;margin:16px 0 8px;color:#24292e}.brief-content h3{font-size:14px;font-weight:600;margin:12px 0 6px;color:#24292e}.brief-content h4{font-size:13px;font-weight:600;margin:10px 0 4px;color:#586069}.brief-content p{margin:8px 0;line-height:1.6}.brief-content ul,.brief-content ol{margin:8px 0 8px 24px}.brief-content li{margin:4px 0;line-height:1.5}.brief-content code{background:#f6f8fa;padding:2px 6px;border-radius:3px;font-size:12px;font-family:'SFMono-Regular',Consolas,monospace}.brief-content pre{background:#24292e;color:#e1e4e8;padding:16px;border-radius:6px;overflow-x:auto;margin:12px 0;font-size:12px;line-height:1.5}.brief-content pre code{background:transparent;padding:0;color:inherit}.brief-content table{width:100%;border-collapse:collapse;margin:12px 0}.brief-content th,.brief-content td{border:1px solid #e1e4e8;padding:8px 12px;text-align:left;font-size:12px}.brief-content th{background:#f6f8fa;font-weight:600}.brief-content hr{border:none;border-top:1px solid #e1e4e8;margin:16px 0}.brief-content a{color:#0366d6}.chart-section{text-align:center;margin:20px 0}.chart-section img{max-width:100%;border:1px solid #e1e4e8;border-radius:6px}.resources{display:flex;gap:12px;flex-wrap:wrap;margin:16px 0}.resource-link{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:1px solid #e1e4e8;border-radius:6px;font-size:12px;font-weight:500;background:#fff;transition:all 0.15s}.resource-link:hover{border-color:#0366d6;background:#f0f7ff;text-decoration:none}.model-answer{border:2px dashed #e1e4e8;border-radius:6px;padding:16px;margin:24px 0}.model-answer summary{cursor:pointer;font-weight:600;font-size:14px;padding:8px;list-style:none}.model-answer summary::-webkit-details-marker{display:none}.model-answer summary::before{content:"+ ";font-family:monospace}.model-answer[open] summary::before{content:"- "}.slide-card{background:#fff;border:1px solid #e1e4e8;border-radius:6px;padding:16px;margin:12px 0}.slide-card h4{font-size:11px;color:#586069;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid #e1e4e8}.slide-card h2{font-size:16px;font-weight:700;margin:8px 0}.slide-card h3{font-size:14px;font-weight:600;margin:6px 0}.slide-card p{margin:6px 0;line-height:1.5}.slide-card ul,.slide-card ol{margin:6px 0 6px 20px}.slide-card li{margin:3px 0}.slide-card img{max-width:100%;border-radius:4px;margin:8px 0}.slide-card table{width:100%;border-collapse:collapse;margin:8px 0}.slide-card th,.slide-card td{border:1px solid #e1e4e8;padding:6px 10px;font-size:12px}.slide-card th{background:#f6f8fa;font-weight:600}.slide-card code{background:#f6f8fa;padding:2px 4px;border-radius:3px;font-size:11px}.slide-card pre{background:#24292e;color:#e1e4e8;padding:12px;border-radius:4px;font-size:11px;overflow-x:auto}.slide-card pre code{background:transparent;padding:0;color:inherit}.prev-next{display:flex;justify-content:space-between;margin:24px 0;padding-top:16px;border-top:1px solid #e1e4e8}.prev-next a{padding:8px 16px;border:1px solid #e1e4e8;border-radius:6px;font-size:12px}.prev-next a:hover{border-color:#0366d6;background:#f0f7ff;text-decoration:none}.foot{text-align:center;padding:16px;font-size:11px;color:#586069;margin-top:20px}.foot a{margin:0 8px}@media(max-width:768px){.container{padding:12px}.assignment-header{padding:16px}.assignment-header h1{font-size:18px}.resources{flex-direction:column}.prev-next{flex-direction:column;gap:8px}}
</style>
</head>
<body>

<nav class="nav"><span class="nav-title">Digital Finance & Economics</span><div class="nav-links"><a href="../index.html">Dashboard</a><a href="../assignments.html">Assignments</a><a href="https://github.com/Digital-AI-Finance/digital-finance-economics" target="_blank">GitHub</a></div></nav>

<div class="container">

<div class="assignment-header" style="background:linear-gradient(135deg,#ef4444,#dc2626)">
<h1>A6: How AMMs Set Prices &mdash; The Constant Product Formula</h1>
<div class="lecture-ref">L06 Market Microstructure &mdash; 45 min analysis + 10 min presentation</div>
</div>

<!-- ===== ASSIGNMENT BRIEF ===== -->
<div class="section-title">Assignment Brief</div>
<div class="brief-content">

<h2>Introduction</h2>
<p>An <strong>AMM (Automated Market Maker)</strong> is a piece of software that lets people trade one cryptocurrency for another without needing a human broker or traditional exchange. AMMs use the <strong>constant product formula</strong> x * y = k where:</p>
<ul>
<li><strong>x</strong> and <strong>y</strong> are the quantities of two tokens in a <strong>liquidity pool</strong> (a shared pot of funds that anyone can trade against)</li>
<li><strong>k</strong> is a constant that never changes</li>
</ul>
<p>When you buy token A, you add token B to the pool and remove token A. This changes the ratio y/x, which automatically changes the price. <strong>Slippage</strong> (the difference between the expected price and the actual price you pay) increases with trade size because larger trades move the ratio more.</p>

<h2>Your Task</h2>
<p>You will explore how different pool parameters affect slippage by modifying the baseline constant product AMM model. Create a 7-slide Marp presentation analyzing three variations and one open extension.</p>

<h3>Baseline Model</h3>
<ul>
<li><strong>Pool depth</strong>: k = 1,000,000</li>
<li><strong>Initial reserves</strong>: x&#8320; = 1000, y&#8320; = 1000 (balanced pool, price = 1.0)</li>
<li><strong>Spot price formula</strong>: P = y/x</li>
<li><strong>Trade formula</strong>: When you buy &Delta;x of token X, you pay &Delta;y = k/(x &minus; &Delta;x) &minus; y tokens of Y</li>
</ul>

<h3>Variations to Analyze</h3>

<h4>Variation 1: Increase pool depth</h4>
<ul>
<li>Set k = 10,000,000 (10x larger pool, meaning &radic;(10M) &asymp; 3162 of each token initially)</li>
<li>How does slippage for a 100-token trade change compared to baseline?</li>
<li>Why does deeper liquidity improve prices?</li>
</ul>

<h4>Variation 2: Imbalanced pool</h4>
<ul>
<li>Set initial reserves: x&#8320; = 500, y&#8320; = 2000 (initial price = y/x = 4.0 instead of 1.0)</li>
<li>Keep k = 1,000,000 (so x&#8320; * y&#8320; = k still holds)</li>
<li>How does the curve shape differ?</li>
<li>What happens to slippage when buying X vs buying Y?</li>
</ul>

<h4>Variation 3: Add 0.3% swap fee</h4>
<ul>
<li>Apply fee to output: effective output = amount_out * 0.997</li>
<li>Compute effective slippage for trades of [10, 50, 100, 200, 500] tokens</li>
<li>Compare to baseline (no fee)</li>
<li>How much does the fee add to total slippage?</li>
</ul>

<h4>Open Extension: Pool Depth Comparison</h4>
<ul>
<li>Create a chart comparing slippage between k = 1M and k = 10M on the same axes</li>
<li>Show slippage curves for trade sizes from 10 to 500 tokens</li>
<li>What is the percentage reduction in slippage at different trade sizes?</li>
</ul>

<hr>

<h2>Deliverables</h2>
<ol>
<li><strong>7-slide Marp presentation</strong> (<code>model-answer-presentation.md</code>):
<ul>
<li>Slide 1: Title + citation (Adams et al. 2021 &mdash; Uniswap v3 Core)</li>
<li>Slide 2: The Model &mdash; formula explanation</li>
<li>Slide 3: Baseline results with baseline chart</li>
<li>Slide 4: Variation 1 results with variation chart</li>
<li>Slide 5: Variation 2 results</li>
<li>Slide 6: Variation 3 results with fee comparison</li>
<li>Slide 7: Key insights &mdash; why pool depth matters</li>
</ul>
</li>
<li><strong>Python chart</strong> (<code>chart_varied.py</code>):
<ul>
<li>2&times;2 subplot grid (16&times;12 inches)</li>
<li>Panel 1: Baseline &mdash; constant product curve with trade arrows for 100 and 500 token trades</li>
<li>Panel 2: Variation 1 &mdash; k = 10M, same trades, show reduced slippage</li>
<li>Panel 3: Variation 2 &mdash; x&#8320; = 500, y&#8320; = 2000, show asymmetric curve</li>
<li>Panel 4: Variation 3 &mdash; bar chart comparing slippage with and without 0.3% fee for trade sizes [10, 50, 100, 200, 500]</li>
<li>Use <code>np.random.seed(42)</code> for reproducibility</li>
<li>Save to <code>chart_varied.pdf</code> and <code>chart_varied.png</code></li>
</ul>
</li>
</ol>

<hr>

<h2>How to Run</h2>
<p>Use <strong>Google Colab</strong> (free, no installation required):</p>
<ol>
<li>Go to <a href="https://colab.research.google.com">colab.research.google.com</a></li>
<li>Upload <code>chart_varied.py</code></li>
<li>Run the script (Runtime &rarr; Run all)</li>
<li>Download generated PNG/PDF from the Files panel (left sidebar)</li>
</ol>
<p>For the Marp presentation:</p>
<ol>
<li>Install the Marp extension in VS Code, or</li>
<li>Use the online Marp editor at <a href="https://marp.app">marp.app</a></li>
</ol>

<hr>

<h2>Time Allocation</h2>
<ul>
<li><strong>Analysis and coding</strong>: 45 minutes</li>
<li><strong>Presentation preparation</strong>: 10 minutes</li>
<li><strong>Total</strong>: 55 minutes</li>
</ul>

<hr>

<h2>Learning Objectives</h2>
<p>By completing this assignment, you will:</p>
<ul>
<li>Understand how the constant product formula x * y = k automatically sets prices</li>
<li>See why larger trades suffer worse slippage (convex, not linear)</li>
<li>Appreciate why liquidity mining exists (deep pools = better prices)</li>
<li>Recognize the importance of pool balance and fee structure</li>
<li>Practice presenting quantitative financial analysis visually</li>
</ul>

<hr>

<h2>Grading Rubric (100 points)</h2>
<table>
<thead><tr><th>Component</th><th>Points</th><th>Criteria</th></tr></thead>
<tbody>
<tr><td>Variation 1 analysis</td><td>20</td><td>Correct k = 10M calculation, slippage comparison</td></tr>
<tr><td>Variation 2 analysis</td><td>20</td><td>Correct imbalanced pool, asymmetric curve explanation</td></tr>
<tr><td>Variation 3 analysis</td><td>20</td><td>Fee calculation correct, slippage comparison table</td></tr>
<tr><td>Chart quality</td><td>20</td><td>All 4 panels correct, annotations clear, professional</td></tr>
<tr><td>Presentation clarity</td><td>15</td><td>Logic flow, key insights highlighted, visuals support text</td></tr>
<tr><td>Open extension</td><td>5</td><td>Thoughtful comparison, actionable insight</td></tr>
</tbody>
</table>

<hr>

<h2>References</h2>
<p>Adams, H., Zinsmeister, N., Salem, M., Keefer, R., &amp; Robinson, D. (2021). <em>Uniswap v3 Core</em>. Retrieved from <a href="https://uniswap.org/whitepaper-v3.pdf">https://uniswap.org/whitepaper-v3.pdf</a></p>

</div>

<!-- ===== MODEL ANSWER ===== -->
<div class="section-title">Model Answer</div>
<details class="model-answer" style="border-color:#ef4444">
<summary>Show Model Answer Presentation (7 slides)</summary>

<!-- Slide 1 -->
<div class="slide-card">
<h4>Slide 1 &mdash; Title</h4>
<h2>How AMMs Set Prices: The Constant Product Formula</h2>
<p><strong>Assignment A6 &mdash; L06 Market Microstructure</strong></p>
<p><em>Reference: Adams, H., Zinsmeister, N., Salem, M., Keefer, R., &amp; Robinson, D. (2021). Uniswap v3 Core</em></p>
</div>

<!-- Slide 2 -->
<div class="slide-card">
<h4>Slide 2 &mdash; The Model</h4>
<h2>The Model: x * y = k (Constant Product)</h2>
<p><strong>Concept</strong>: An AMM maintains a liquidity pool with two tokens (X, Y) where the product of reserves is constant:</p>
$$x \cdot y = k \quad \text{(invariant)}$$
<p><strong>Spot Price</strong>: The marginal exchange rate is:</p>
$$P = \frac{y}{x}$$
<p><strong>Trade Mechanics</strong>: To buy &Delta;x of token X, you must pay &Delta;y of token Y such that:</p>
$$(x - \Delta x) \cdot (y + \Delta y) = k$$
<p>Solving: $\Delta y = \frac{k}{x - \Delta x} - y$</p>
<p><strong>Slippage</strong>: Effective price $P_{eff} = \Delta y / \Delta x$ exceeds spot price P due to convex curve (not linear).</p>
</div>

<!-- Slide 3 -->
<div class="slide-card">
<h4>Slide 3 &mdash; Baseline Results</h4>
<h2>Baseline Results (k = 1M, x&#8320; = y&#8320; = 1000)</h2>
<div class="chart-section">
<img src="../L06_Market_Microstructure/01_amm_constant_product/chart.png" style="max-width:100%">
</div>
<p><strong>Observations</strong>:</p>
<ul>
<li><strong>Trade 100 X</strong>: Costs 111 Y &rarr; effective price 1.111 Y/X &rarr; <strong>11.1% slippage</strong></li>
<li><strong>Trade 500 X</strong>: Costs 1000 Y &rarr; effective price 2.0 Y/X &rarr; <strong>100% slippage</strong></li>
<li>Slippage grows <strong>nonlinearly</strong> (convex function)</li>
</ul>
</div>

<!-- Slide 4 -->
<div class="slide-card">
<h4>Slide 4 &mdash; Variation 1</h4>
<h2>Variation 1: Deeper Pool (k = 10M)</h2>
<div class="chart-section">
<img src="l06-presentation/chart_varied.png" style="max-width:100%">
</div>
<p><em>(Panel 2: k = 10M &mdash; note reduced slippage)</em></p>
<p><strong>Results</strong>:</p>
<ul>
<li>Same 100 X trade now costs ~103.8 Y &rarr; <strong>~3.8% slippage</strong> (down from 11.1%)</li>
<li><strong>Slippage reduction</strong>: ~66% improvement with 10x deeper liquidity</li>
<li><strong>Why?</strong>: Larger k means flatter curve &rarr; smaller percentage change in y/x ratio</li>
</ul>
<p><strong>Key Insight</strong>: This is why liquidity mining exists &mdash; deeper pools attract traders with better prices.</p>
</div>

<!-- Slide 5 -->
<div class="slide-card">
<h4>Slide 5 &mdash; Variation 2</h4>
<h2>Variation 2: Imbalanced Pool (x&#8320; = 500, y&#8320; = 2000)</h2>
<div class="chart-section">
<img src="l06-presentation/chart_varied.png" style="max-width:100%">
</div>
<p><em>(Panel 3: Asymmetric curve with initial price P = 4.0)</em></p>
<p><strong>Results</strong>:</p>
<ul>
<li>Initial price P = y/x = 2000/500 = <strong>4.0 Y/X</strong> (not 1.0)</li>
<li>Curve is <strong>steeper on the X-side</strong> (buying X is expensive)</li>
<li>Curve is <strong>flatter on the Y-side</strong> (buying Y is cheaper)</li>
<li><strong>Asymmetry</strong>: Traders pay more slippage when buying the scarce asset (X)</li>
</ul>
<p><strong>Implication</strong>: Arbitrageurs will rebalance the pool toward x&#8320; = y&#8320; if external price differs.</p>
</div>

<!-- Slide 6 -->
<div class="slide-card">
<h4>Slide 6 &mdash; Variation 3</h4>
<h2>Variation 3: Adding 0.3% Swap Fee</h2>
<div class="chart-section">
<img src="l06-presentation/chart_varied.png" style="max-width:100%">
</div>
<p><em>(Panel 4: Slippage comparison with and without fee)</em></p>
<p><strong>Fee Model</strong>: Effective output = amount_out &times; 0.997</p>
<table>
<thead><tr><th>Trade Size (X)</th><th>Slippage (no fee)</th><th>Slippage (with 0.3% fee)</th><th>Fee Impact</th></tr></thead>
<tbody>
<tr><td>10</td><td>1.0%</td><td>1.3%</td><td>+0.3 pp</td></tr>
<tr><td>50</td><td>5.3%</td><td>5.6%</td><td>+0.3 pp</td></tr>
<tr><td>100</td><td>11.1%</td><td>11.4%</td><td>+0.3 pp</td></tr>
<tr><td>200</td><td>25.0%</td><td>25.4%</td><td>+0.4 pp</td></tr>
<tr><td>500</td><td>100.0%</td><td>100.6%</td><td>+0.6 pp</td></tr>
</tbody>
</table>
<p><strong>Observation</strong>: Fee adds constant ~0.3 percentage points. For large trades, <strong>slippage dominates fees</strong>.</p>
</div>

<!-- Slide 7 -->
<div class="slide-card">
<h4>Slide 7 &mdash; Key Insights</h4>
<h2>Key Insights: Why Pool Depth Is Everything</h2>
<ol>
<li><strong>Nonlinear Slippage</strong>: x * y = k creates convex curve &rarr; slippage grows faster than trade size</li>
<li><strong>Liquidity Is King</strong>: 10x deeper pool (k = 10M) cuts slippage by ~70% for same trade
<ul>
<li>This is why protocols offer liquidity mining rewards (LP tokens, governance tokens)</li>
<li>Traders prefer deep pools &rarr; more volume &rarr; more fees for LPs &rarr; positive feedback loop</li>
</ul>
</li>
<li><strong>Balance Matters</strong>: Imbalanced pools punish trades in the scarce direction
<ul>
<li>Arbitrage naturally rebalances pools toward 50/50 split</li>
</ul>
</li>
<li><strong>Fees Are Secondary</strong>: For large trades, slippage (11%) &gt;&gt; fees (0.3%)
<ul>
<li>Protocol revenue comes from volume, not high fees</li>
</ul>
</li>
<li><strong>Design Trade-off</strong>: Constant product is simple but capital inefficient
<ul>
<li>Uniswap v3 uses concentrated liquidity to improve this</li>
</ul>
</li>
</ol>
</div>

</details>

<!-- ===== PREV/NEXT ===== -->
<div class="prev-next">
<a href="assignment5.html">&larr; A5: Winner-Take-All</a>
<a href="assignment7.html">A7: Regulatory Game Theory &rarr;</a>
</div>

</div>

<footer class="foot">
<a href="https://github.com/Digital-AI-Finance/digital-finance-economics">GitHub Repository</a> &middot; &copy; Joerg Osterrieder 2026
</footer>

</body>
</html>
