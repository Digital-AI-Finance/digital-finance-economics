<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: L02 Monetary Economics | Digital Finance & Economics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        :root {
            --mlpurple: #3333B2;
            --mlblue: #0066CC;
            --quiz-accent: #8b5cf6;
            --quiz-light: #ede9fe;
            --correct: #22c55e;
            --correct-bg: #dcfce7;
            --incorrect: #ef4444;
            --incorrect-bg: #fee2e2;
            --bg: #f6f8fa;
            --card-bg: #ffffff;
            --text: #24292e;
            --text-secondary: #586069;
            --border: #e1e4e8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
            min-height: 100vh;
        }

        .nav {
            background: linear-gradient(135deg, var(--mlpurple), var(--mlblue));
            color: white;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-title { font-weight: 600; font-size: 14px; }
        .nav-links { display: flex; gap: 16px; }
        .nav-links a { color: white; text-decoration: none; font-size: 12px; opacity: 0.9; }
        .nav-links a:hover { opacity: 1; }

        .quiz-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 0 4px;
        }
        .quiz-title { font-size: 16px; font-weight: 600; color: var(--mlpurple); }
        .quiz-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
        }
        .stat-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        .stat-progress { background: var(--quiz-light); color: var(--quiz-accent); }
        .stat-score { background: var(--correct-bg); color: var(--correct); }

        .progress-bar-container {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-bottom: 12px;
        }
        .progress-bar {
            height: 100%;
            background: var(--quiz-accent);
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Three-column layout */
        .questions-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 12px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            min-height: 280px;
        }

        .question-card.answered { opacity: 0.7; }

        .question-card.correct-card {
            border: 2px solid var(--correct);
            background: linear-gradient(to bottom, var(--correct-bg), var(--card-bg));
        }

        .question-card.incorrect-card {
            border: 2px solid var(--incorrect);
            background: linear-gradient(to bottom, var(--incorrect-bg), var(--card-bg));
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .q-number {
            background: var(--quiz-light);
            color: var(--quiz-accent);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .q-status { font-size: 14px; }

        .q-text {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-grow: 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-grow: 1;
        }

        .option-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            min-height: 44px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--card-bg);
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            font-size: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--quiz-accent);
            background: var(--quiz-light);
        }

        .option-btn.correct {
            border-color: var(--correct);
            background: var(--correct-bg);
        }

        .option-btn.incorrect {
            border-color: var(--incorrect);
            background: var(--incorrect-bg);
        }

        .option-btn.disabled { cursor: default; }

        .option-letter {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 10px;
            flex-shrink: 0;
        }

        .option-btn.correct .option-letter {
            background: var(--correct);
            color: white;
        }

        .option-btn.incorrect .option-letter {
            background: var(--incorrect);
            color: white;
        }

        .option-text { flex: 1; }

        .feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            line-height: 1.4;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: var(--correct-bg); color: #166534; }
        .feedback.incorrect { background: var(--incorrect-bg); color: #991b1b; }

        /* Results */
        .results-card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 32px;
            text-align: center;
            max-width: 500px;
            margin: 40px auto;
            display: none;
        }
        .results-card.show { display: block; }
        .results-icon { font-size: 48px; margin-bottom: 8px; }
        .results-score { font-size: 36px; font-weight: 700; color: var(--quiz-accent); }
        .results-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
        .results-grade {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .grade-a { background: #dcfce7; color: #166534; }
        .grade-b { background: #dbeafe; color: #1e40af; }
        .grade-c { background: #fef3c7; color: #92400e; }
        .grade-d { background: #fed7aa; color: #9a3412; }
        .grade-f { background: #fee2e2; color: #991b1b; }

        .results-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        .btn-primary { background: var(--quiz-accent); color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-secondary { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }

        /* Next button container */
        .next-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }
        .btn-next {
            padding: 10px 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: var(--quiz-accent);
            color: white;
            transition: all 0.2s;
            display: none;
        }
        .btn-next:hover { background: #7c3aed; transform: scale(1.02); }
        .btn-next.show { display: inline-block; }
        .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }

        @media (max-width: 900px) {
            .questions-row { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .questions-row { grid-template-columns: 1fr; }
            .question-card { min-height: auto; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-title">Quiz: L02 Monetary Economics</div>
        <div class="nav-links">
            <a href="../index.html">Dashboard</a>
            
            <a href="https://github.com/Digital-AI-Finance/digital-finance-economics" target="_blank">GitHub</a>
        </div>
    </nav>

    <main class="quiz-container">
        <div class="quiz-header">
            <div class="quiz-title">Quiz: L02 Monetary Economics</div>
            <div class="quiz-stats">
                <span class="stat-badge stat-progress" id="progressBadge">0/20</span>
                <span class="stat-badge stat-score" id="scoreBadge">Score: 0</span>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="questions-row" id="questionsRow"></div>

        <div class="next-btn-container">
            <button class="btn-next" id="nextBtn" onclick="loadNextQuestions()">Next</button>
        </div>

        <div class="results-card" id="resultsCard">
            <div class="results-icon" id="resultsIcon"></div>
            <div class="results-score" id="resultsScore"></div>
            <div class="results-label">Correct Answers</div>
            <div class="results-grade" id="resultsGrade"></div>
            <div class="results-buttons">
                <button class="btn btn-primary" onclick="restartQuiz()">Try Again</button>
                <a href="../index.html" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>
    </main>

    <script>
        const quizData = {
            questions: [
                {
                                "id": 1,
                                "question": "What is the primary economic rationale for money serving as a medium of exchange?",
                                "options": {
                                                "A": "It provides a stable store of value over time",
                                                "B": "It eliminates barter inefficiency and reduces transaction costs",
                                                "C": "It enables governments to collect seigniorage",
                                                "D": "It creates network effects that benefit early adopters"
                                },
                                "correct": "B",
                                "explanation": "The medium of exchange function eliminates the inefficiency of barter and reduces search and matching costs. Transaction cost = c_b - c_m where c_m << c_b (money transaction costs are much lower than barter costs)."
                },
                {
                                "id": 2,
                                "question": "How many price relationships are needed in an economy with 10 goods when money serves as the unit of account, compared to a barter economy?",
                                "options": {
                                                "A": "100 prices vs. 45 prices",
                                                "B": "9 prices vs. 45 prices",
                                                "C": "10 prices vs. 90 prices",
                                                "D": "9 prices vs. 100 prices"
                                },
                                "correct": "B",
                                "explanation": "With n goods, barter requires n(n-1)/2 price relationships. With money as unit of account, only n-1 prices are needed. For 10 goods: barter needs 10×9/2 = 45 prices, while money needs only 10-1 = 9 prices, drastically reducing cognitive costs."
                },
                {
                                "id": 3,
                                "question": "What requirement must a good store of value fulfill regarding volatility?",
                                "options": {
                                                "A": "Its volatility must be higher than goods to protect against inflation",
                                                "B": "Its volatility must be lower than goods to maintain stable purchasing power",
                                                "C": "Its volatility must match goods prices exactly",
                                                "D": "Volatility is irrelevant for store of value function"
                                },
                                "correct": "B",
                                "explanation": "A store of value requires low volatility: σ_money < σ_goods. This ensures stable purchasing power and makes it suitable for storing wealth over time. High volatility undermines the store of value function."
                },
                {
                                "id": 4,
                                "question": "What key trade-off exists between the medium of exchange and store of value functions of money?",
                                "options": {
                                                "A": "Both functions always reinforce each other",
                                                "B": "A good medium of exchange may not be an ideal store of value",
                                                "C": "Store of value function always takes priority over medium of exchange",
                                                "D": "The trade-off only applies to digital currencies, not fiat money"
                                },
                                "correct": "B",
                                "explanation": "The lecture notes explicitly state 'Trade-offs exist: a good medium of exchange may not be ideal store of value.' This is evident in cryptocurrencies where Bitcoin's volatility makes it a poor medium of exchange despite some treating it as a store of value."
                },
                {
                                "id": 5,
                                "question": "Which requirements are essential for money to function as a medium of exchange?",
                                "options": {
                                                "A": "Fixed supply, government backing, and gold convertibility",
                                                "B": "Acceptability, divisibility, and portability",
                                                "C": "High volatility, speculative value, and scarcity",
                                                "D": "Blockchain technology, cryptographic security, and decentralization"
                                },
                                "correct": "B",
                                "explanation": "The three essential requirements for medium of exchange are acceptability (network effect), divisibility (ability to make change for various transaction sizes), and portability (easy to transport). These are fundamental economic requirements independent of technology."
                },
                {
                                "id": 6,
                                "question": "In the quantity theory equation MV = PY, if money supply M increases by 10% while velocity V and real output Y remain constant, what happens to the price level P?",
                                "options": {
                                                "A": "P decreases by 10%",
                                                "B": "P remains unchanged",
                                                "C": "P increases by 10%",
                                                "D": "P increases by 20%"
                                },
                                "correct": "C",
                                "explanation": "In the equation MV = PY, if V and Y are constant, then changes in M translate directly to proportional changes in P. A 10% increase in M leads to a 10% increase in P, demonstrating the quantity theory's prediction that inflation is fundamentally a monetary phenomenon."
                },
                {
                                "id": 7,
                                "question": "What is a major complication when applying the quantity theory MV = PY to Bitcoin?",
                                "options": {
                                                "A": "Bitcoin's money supply M is fixed at 21 million, creating deflationary pressure",
                                                "B": "Bitcoin has no transaction velocity",
                                                "C": "Bitcoin cannot be measured in any price units",
                                                "D": "Bitcoin's real output Y is infinite"
                                },
                                "correct": "A",
                                "explanation": "Bitcoin's fixed supply cap of 21 million creates deflationary pressure, which is incompatible with the medium of exchange function. Additionally, Bitcoin's velocity V is highly volatile (ranging 2-20+) and hard to measure, and there's ambiguity about which price level P to use since crypto is priced in fiat."
                },
                {
                                "id": 8,
                                "question": "How does Bitcoin's velocity compare to traditional fiat money?",
                                "options": {
                                                "A": "Bitcoin velocity is stable at 5-7 like traditional money",
                                                "B": "Bitcoin velocity is always lower than fiat money",
                                                "C": "Bitcoin velocity varies from 2 to 20+, much more volatile than fiat's 5-7",
                                                "D": "Bitcoin has zero velocity due to being a store of value"
                                },
                                "correct": "C",
                                "explanation": "Traditional money has relatively stable velocity at approximately 5-7, while Bitcoin's velocity varies dramatically from 2 to 20+. This high volatility makes it difficult to apply the quantity theory reliably to Bitcoin and reflects its speculative nature rather than use as transaction medium."
                },
                {
                                "id": 9,
                                "question": "What is seigniorage in traditional monetary systems, expressed formally?",
                                "options": {
                                                "A": "S = M × P, the total value of money in circulation",
                                                "B": "S = ΔM/M × M/P, revenue from money creation accruing to the government",
                                                "C": "S = PY/MV, the real value of economic output",
                                                "D": "S = V × M, the total transaction volume"
                                },
                                "correct": "B",
                                "explanation": "Seigniorage is the revenue from money creation: S = Ṁ/P = ΔM/M × M/P. It represents the inflation tax on money holders and accrues to the central bank/government. This is the profit from creating money at minimal cost."
                },
                {
                                "id": 10,
                                "question": "How does seigniorage work differently for stablecoins compared to traditional fiat currencies?",
                                "options": {
                                                "A": "Stablecoins have no seigniorage because they are backed 1:1",
                                                "B": "Stablecoin issuers capture seigniorage by earning interest on reserves while users bear opportunity cost",
                                                "C": "Stablecoin seigniorage goes to governments through taxation",
                                                "D": "Stablecoin seigniorage is distributed to all token holders"
                                },
                                "correct": "B",
                                "explanation": "Stablecoin issuers like Tether capture seigniorage by earning interest on the reserves backing the stablecoins, while users who hold the stablecoins bear the opportunity cost. Tether earns billions annually from this model, representing a transfer of monetary rents from public to private hands."
                },
                {
                                "id": 11,
                                "question": "What grade does the lecture assign to Bitcoin as a medium of exchange, and why?",
                                "options": {
                                                "A": "Grade A - excellent acceptance and low costs",
                                                "B": "Grade C- - limited merchant acceptance, high transaction costs at times, and slow confirmation",
                                                "C": "Grade F - complete failure as a payment method",
                                                "D": "Grade B - good but with minor issues"
                                },
                                "correct": "B",
                                "explanation": "Bitcoin receives a C- grade as medium of exchange due to limited merchant acceptance, high transaction costs (at times), 10-60 minute confirmation times, and the blockchain scalability trilemma. These factors make it impractical for everyday transactions."
                },
                {
                                "id": 12,
                                "question": "Why does Bitcoin receive an F grade as a unit of account?",
                                "options": {
                                                "A": "It cannot be divided into smaller units",
                                                "B": "It has extreme volatility, high menu costs of repricing, and no contracts are denominated in BTC",
                                                "C": "It is illegal to price goods in Bitcoin",
                                                "D": "Bitcoin's supply is too limited for pricing"
                                },
                                "correct": "B",
                                "explanation": "Bitcoin fails as a unit of account (Grade F) due to extreme volatility creating high 'menu costs' of constantly repricing goods, and the fact that virtually no contracts are denominated in BTC. Its 50-85% volatility vs EUR/USD's 5-10% makes it unsuitable for this function."
                },
                {
                                "id": 13,
                                "question": "What grade does Bitcoin receive as a store of value, and what is the primary justification?",
                                "options": {
                                                "A": "Grade F - it has no value storage capability",
                                                "B": "Grade A - it's the perfect store of value",
                                                "C": "Grade C - long-term appreciation potential but high volatility and correlation with risk assets",
                                                "D": "Grade B+ - better than most fiat currencies"
                                },
                                "correct": "C",
                                "explanation": "Bitcoin receives a C grade as store of value. While it has shown long-term appreciation and the 'digital gold' narrative provides some justification, it suffers from high volatility and correlation with risk assets rather than serving as a safe haven. This makes it less reliable as a store of value."
                },
                {
                                "id": 14,
                                "question": "According to Yermack (2015), what is Bitcoin's primary characteristic?",
                                "options": {
                                                "A": "An ideal currency for everyday transactions",
                                                "B": "A speculative investment rather than a currency, with low correlation to currencies and high correlation to tech stocks",
                                                "C": "A stable store of value similar to gold",
                                                "D": "A perfect unit of account for international trade"
                                },
                                "correct": "B",
                                "explanation": "Yermack (2015) concluded that 'Bitcoin behaves more like a speculative investment than a currency.' It shows low correlation with major currencies, high correlation with tech stocks, and is driven by speculation rather than trade, confirming it fails the key money functions."
                },
                {
                                "id": 15,
                                "question": "What characterizes fiat-backed stablecoins like USDT and USDC?",
                                "options": {
                                                "A": "They are over-collateralized at 150%+ with cryptocurrency",
                                                "B": "They maintain 1:1 reserves in bank accounts with trust in issuer and redemption guarantees",
                                                "C": "They use algorithmic mechanisms with no collateral backing",
                                                "D": "They are backed by government bonds only"
                                },
                                "correct": "B",
                                "explanation": "Fiat-backed stablecoins like USDT and USDC maintain 1:1 reserves in bank accounts, rely on trust in the issuer and audits, and provide redemption guarantees. This makes them the most straightforward stablecoin design but requires centralized trust."
                },
                {
                                "id": 16,
                                "question": "How do crypto-backed stablecoins like DAI maintain their peg?",
                                "options": {
                                                "A": "Through 1:1 fiat reserves held in banks",
                                                "B": "Through over-collateralization at 150%+ with smart contract enforcement and liquidation mechanisms",
                                                "C": "Through algorithmic arbitrage with no collateral",
                                                "D": "Through government backing and central bank reserves"
                                },
                                "correct": "B",
                                "explanation": "Crypto-backed stablecoins like DAI use over-collateralization (typically 150%+) with cryptocurrency, smart contract enforcement, and automated liquidation mechanisms to maintain their peg. This provides more decentralization than fiat-backed but requires capital inefficiency."
                },
                {
                                "id": 17,
                                "question": "What was the fundamental problem with algorithmic stablecoins like Terra (UST)?",
                                "options": {
                                                "A": "They had too much collateral backing",
                                                "B": "They had no collateral backing and relied on arbitrage-based stability, making them prone to death spirals",
                                                "C": "They were backed by unreliable fiat currencies",
                                                "D": "They were over-regulated by governments"
                                },
                                "correct": "B",
                                "explanation": "Algorithmic stablecoins like Terra (UST) had no collateral backing and relied purely on arbitrage-based stability mechanisms. This made them inherently fragile and prone to death spirals, as demonstrated by Terra's collapse in 2022 causing $40B+ in losses. The lecture emphasizes these designs are fundamentally flawed."
                },
                {
                                "id": 18,
                                "question": "What does Gresham's Law state, and how does it apply to cryptocurrency?",
                                "options": {
                                                "A": "'Good money drives out bad' - people spend valuable crypto and hoard fiat",
                                                "B": "'Bad money drives out good' - when two currencies circulate at fixed rate, undervalued currency is hoarded (Bitcoin 'HODL') while overvalued currency (stablecoins) is spent",
                                                "C": "All currencies eventually become worthless",
                                                "D": "Digital currencies always replace physical currencies"
                                },
                                "correct": "B",
                                "explanation": "Gresham's Law states 'bad money drives out good.' When two currencies circulate at a fixed rate, the undervalued currency is hoarded while the overvalued one is spent. In crypto, this manifests as Bitcoin being hoarded ('HODL' culture) while stablecoins are used for transactions, creating a self-fulfilling prophecy that reduces velocity."
                },
                {
                                "id": 19,
                                "question": "What is 'crypto-ization' and in which countries is it observed?",
                                "options": {
                                                "A": "The process of converting fiat to cryptocurrency for investment",
                                                "B": "Currency substitution where weak local currencies are replaced by cryptocurrencies, observed in high-inflation countries like Argentina, Venezuela, and Turkey",
                                                "C": "The mining of new cryptocurrencies",
                                                "D": "Government adoption of blockchain technology"
                                },
                                "correct": "B",
                                "explanation": "Crypto-ization is analogous to dollarization - it's currency substitution where weak local currencies are replaced by cryptocurrencies. This occurs in high-inflation countries like Argentina, Venezuela, and Turkey where citizens seek to preserve value by shifting to crypto assets."
                },
                {
                                "id": 20,
                                "question": "What are the economic consequences of currency substitution (dollarization or crypto-ization)?",
                                "options": {
                                                "A": "Increased monetary policy effectiveness and financial stability",
                                                "B": "Loss of monetary policy autonomy, seigniorage transfer abroad, and financial stability risks",
                                                "C": "Lower inflation and higher economic growth automatically",
                                                "D": "Elimination of all exchange rate risks"
                                },
                                "correct": "B",
                                "explanation": "Currency substitution leads to loss of monetary policy autonomy (can't control domestic money supply), seigniorage transfer abroad (monetary rents captured by foreign issuers), and financial stability risks. These consequences apply whether substitution is with dollars or cryptocurrencies."
                }
]
        };

        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            displayedQuestions: [],
            pendingSlots: []
        };

        const questionsRow = document.getElementById('questionsRow');
        const progressBar = document.getElementById('progressBar');
        const progressBadge = document.getElementById('progressBadge');
        const scoreBadge = document.getElementById('scoreBadge');
        const resultsCard = document.getElementById('resultsCard');
        const nextBtn = document.getElementById('nextBtn');

        function initQuiz() {
            state.currentIndex = 0;
            state.answers = {};
            state.score = 0;
            state.displayedQuestions = [];
            state.pendingSlots = [];

            resultsCard.classList.remove('show');
            questionsRow.style.display = 'grid';
            nextBtn.classList.remove('show');

            // Show first 3 questions
            for (let i = 0; i < 3 && i < quizData.questions.length; i++) {
                state.displayedQuestions.push(i);
            }
            state.currentIndex = Math.min(3, quizData.questions.length);

            renderQuestions();
            updateStats();
        }

        function renderQuestions() {
            questionsRow.innerHTML = '';

            state.displayedQuestions.forEach((qIdx, slot) => {
                const q = quizData.questions[qIdx];
                const answered = state.answers[q.id] !== undefined;
                const isCorrect = answered && state.answers[q.id] === q.correct;
                const isIncorrect = answered && state.answers[q.id] !== q.correct;

                const card = document.createElement('div');
                card.className = 'question-card';
                if (isCorrect) card.classList.add('correct-card', 'answered');
                if (isIncorrect) card.classList.add('incorrect-card', 'answered');

                card.innerHTML = `
                    <div class="q-header">
                        <span class="q-number">Q${qIdx + 1}</span>
                        ${answered ? `<span class="q-status">${isCorrect ? '&#10004;' : '&#10008;'}</span>` : ''}
                    </div>
                    <div class="q-text">${q.question}</div>
                    <div class="options" data-qid="${q.id}" data-slot="${slot}">
                        ${['A','B','C','D'].map(letter => {
                            let optClass = 'option-btn';
                            if (answered) {
                                optClass += ' disabled';
                                if (letter === q.correct) optClass += ' correct';
                                else if (letter === state.answers[q.id]) optClass += ' incorrect';
                            }
                            return `
                                <button class="${optClass}" data-letter="${letter}" ${answered ? 'disabled' : ''}>
                                    <span class="option-letter">${letter}</span>
                                    <span class="option-text">${q.options[letter]}</span>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    <div class="feedback ${answered ? 'show' : ''} ${isCorrect ? 'correct' : 'incorrect'}">
                        ${answered ? (isCorrect ? '&#10004; ' : `&#10008; Answer: ${q.correct}. `) + q.explanation : ''}
                    </div>
                `;

                // Add click handlers
                if (!answered) {
                    card.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => handleAnswer(qIdx, slot, btn.dataset.letter));
                    });
                }

                questionsRow.appendChild(card);
            });

            renderMath();
        }

        function handleAnswer(qIdx, slot, letter) {
            const q = quizData.questions[qIdx];
            state.answers[q.id] = letter;

            if (letter === q.correct) state.score++;

            // Track this slot as pending replacement
            if (!state.pendingSlots.includes(slot)) {
                state.pendingSlots.push(slot);
            }

            updateStats();
            renderQuestions();

            // Check if all questions answered
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                // Short delay then show results
                setTimeout(showResults, 800);
            } else if (state.currentIndex < quizData.questions.length && state.pendingSlots.length > 0) {
                // Show Next button if there are more questions and pending slots
                nextBtn.classList.add('show');
            }
        }

        function loadNextQuestions() {
            // Replace pending slots with new questions
            while (state.pendingSlots.length > 0 && state.currentIndex < quizData.questions.length) {
                const slot = state.pendingSlots.shift();
                state.displayedQuestions[slot] = state.currentIndex;
                state.currentIndex++;
            }

            // Hide Next button
            nextBtn.classList.remove('show');

            renderQuestions();

            // Check if quiz is complete (all displayed questions answered)
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                setTimeout(showResults, 500);
            }
        }

        function updateStats() {
            const answered = Object.keys(state.answers).length;
            const total = quizData.questions.length;

            progressBar.style.width = `${(answered / total) * 100}%`;
            progressBadge.textContent = `${answered}/${total}`;
            scoreBadge.textContent = `Score: ${state.score}`;
        }

        function showResults() {
            questionsRow.style.display = 'none';
            nextBtn.classList.remove('show');
            resultsCard.classList.add('show');

            const total = quizData.questions.length;
            const percentage = Math.round((state.score / total) * 100);

            document.getElementById('resultsScore').textContent = `${state.score}/${total}`;

            let grade, gradeClass, icon;
            if (percentage >= 90) { grade = 'Excellent! A'; gradeClass = 'grade-a'; icon = '&#127942;'; }
            else if (percentage >= 80) { grade = 'Great! B'; gradeClass = 'grade-b'; icon = '&#11088;'; }
            else if (percentage >= 70) { grade = 'Good! C'; gradeClass = 'grade-c'; icon = '&#128077;'; }
            else if (percentage >= 60) { grade = 'Pass - D'; gradeClass = 'grade-d'; icon = '&#128221;'; }
            else { grade = 'Keep practicing'; gradeClass = 'grade-f'; icon = '&#128218;'; }

            document.getElementById('resultsIcon').innerHTML = icon;
            const gradeEl = document.getElementById('resultsGrade');
            gradeEl.textContent = `${grade} (${percentage}%)`;
            gradeEl.className = `results-grade ${gradeClass}`;
        }

        function restartQuiz() {
            initQuiz();
        }

        function renderMath() {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initQuiz();
            setTimeout(renderMath, 100);
        });
    </script>
</body>
</html>
