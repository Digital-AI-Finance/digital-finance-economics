<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: L05 Platform Token Economics | Digital Finance & Economics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        :root {
            --mlpurple: #3333B2;
            --mlblue: #0066CC;
            --quiz-accent: #8b5cf6;
            --quiz-light: #ede9fe;
            --correct: #22c55e;
            --correct-bg: #dcfce7;
            --incorrect: #ef4444;
            --incorrect-bg: #fee2e2;
            --bg: #f6f8fa;
            --card-bg: #ffffff;
            --text: #24292e;
            --text-secondary: #586069;
            --border: #e1e4e8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
            min-height: 100vh;
        }

        .nav {
            background: linear-gradient(135deg, var(--mlpurple), var(--mlblue));
            color: white;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-title { font-weight: 600; font-size: 14px; }
        .nav-links { display: flex; gap: 16px; }
        .nav-links a { color: white; text-decoration: none; font-size: 12px; opacity: 0.9; }
        .nav-links a:hover { opacity: 1; }

        .quiz-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 0 4px;
        }
        .quiz-title { font-size: 16px; font-weight: 600; color: var(--mlpurple); }
        .quiz-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
        }
        .stat-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        .stat-progress { background: var(--quiz-light); color: var(--quiz-accent); }
        .stat-score { background: var(--correct-bg); color: var(--correct); }

        .progress-bar-container {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-bottom: 12px;
        }
        .progress-bar {
            height: 100%;
            background: var(--quiz-accent);
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Three-column layout */
        .questions-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 12px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            min-height: 280px;
        }

        .question-card.answered { opacity: 0.7; }

        .question-card.correct-card {
            border: 2px solid var(--correct);
            background: linear-gradient(to bottom, var(--correct-bg), var(--card-bg));
        }

        .question-card.incorrect-card {
            border: 2px solid var(--incorrect);
            background: linear-gradient(to bottom, var(--incorrect-bg), var(--card-bg));
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .q-number {
            background: var(--quiz-light);
            color: var(--quiz-accent);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .q-status { font-size: 14px; }

        .q-text {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-grow: 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-grow: 1;
        }

        .option-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            min-height: 44px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--card-bg);
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            font-size: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--quiz-accent);
            background: var(--quiz-light);
        }

        .option-btn.correct {
            border-color: var(--correct);
            background: var(--correct-bg);
        }

        .option-btn.incorrect {
            border-color: var(--incorrect);
            background: var(--incorrect-bg);
        }

        .option-btn.disabled { cursor: default; }

        .option-letter {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 10px;
            flex-shrink: 0;
        }

        .option-btn.correct .option-letter {
            background: var(--correct);
            color: white;
        }

        .option-btn.incorrect .option-letter {
            background: var(--incorrect);
            color: white;
        }

        .option-text { flex: 1; }

        .feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            line-height: 1.4;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: var(--correct-bg); color: #166534; }
        .feedback.incorrect { background: var(--incorrect-bg); color: #991b1b; }

        /* Results */
        .results-card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 32px;
            text-align: center;
            max-width: 500px;
            margin: 40px auto;
            display: none;
        }
        .results-card.show { display: block; }
        .results-icon { font-size: 48px; margin-bottom: 8px; }
        .results-score { font-size: 36px; font-weight: 700; color: var(--quiz-accent); }
        .results-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
        .results-grade {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .grade-a { background: #dcfce7; color: #166534; }
        .grade-b { background: #dbeafe; color: #1e40af; }
        .grade-c { background: #fef3c7; color: #92400e; }
        .grade-d { background: #fed7aa; color: #9a3412; }
        .grade-f { background: #fee2e2; color: #991b1b; }

        .results-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        .btn-primary { background: var(--quiz-accent); color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-secondary { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }

        /* Next button container */
        .next-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }
        .btn-next {
            padding: 10px 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: var(--quiz-accent);
            color: white;
            transition: all 0.2s;
            display: none;
        }
        .btn-next:hover { background: #7c3aed; transform: scale(1.02); }
        .btn-next.show { display: inline-block; }
        .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }

        @media (max-width: 900px) {
            .questions-row { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .questions-row { grid-template-columns: 1fr; }
            .question-card { min-height: auto; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-title">Quiz: L05 Platform Token Economics</div>
        <div class="nav-links">
            <a href="../index.html">Dashboard</a>
            
            <a href="https://github.com/Digital-AI-Finance/digital-finance-economics" target="_blank">GitHub</a>
        </div>
    </nav>

    <main class="quiz-container">
        <div class="quiz-header">
            <div class="quiz-title">Quiz: L05 Platform Token Economics</div>
            <div class="quiz-stats">
                <span class="stat-badge stat-progress" id="progressBadge">0/20</span>
                <span class="stat-badge stat-score" id="scoreBadge">Score: 0</span>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="questions-row" id="questionsRow"></div>

        <div class="next-btn-container">
            <button class="btn-next" id="nextBtn" onclick="loadNextQuestions()">Next</button>
        </div>

        <div class="results-card" id="resultsCard">
            <div class="results-icon" id="resultsIcon"></div>
            <div class="results-score" id="resultsScore"></div>
            <div class="results-label">Correct Answers</div>
            <div class="results-grade" id="resultsGrade"></div>
            <div class="results-buttons">
                <button class="btn btn-primary" onclick="restartQuiz()">Try Again</button>
                <a href="../index.html" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>
    </main>

    <script>
        const quizData = {
            questions: [
                {
                                "id": 1,
                                "question": "In the Bass diffusion model, what do the parameters p and q represent?",
                                "options": {
                                                "A": "p = innovation coefficient (external influence), q = imitation coefficient (internal influence)",
                                                "B": "p = price elasticity, q = quality factor",
                                                "C": "p = profit margin, q = quantity demanded",
                                                "D": "p = platform size, q = quarterly growth rate"
                                },
                                "correct": "A",
                                "explanation": "The Bass model describes adoption through external innovation (p) where users adopt independently, and internal imitation (q) where users adopt based on existing adopters. The diffusion equation is dN/dt = (p + q*N/M)*(M - N)."
                },
                {
                                "id": 2,
                                "question": "According to the platform adoption simulations, which platform type reaches its inflection point fastest?",
                                "options": {
                                                "A": "Traditional Bank (p=0.01, q=0.1)",
                                                "B": "Fintech (p=0.03, q=0.4)",
                                                "C": "Crypto Exchange (p=0.05, q=0.25)",
                                                "D": "All reach inflection at the same time"
                                },
                                "correct": "B",
                                "explanation": "Fintech platforms show the fastest adoption with high innovation (p=0.03) and strong network effects (q=0.4), reaching their inflection point earliest. The combination of both external and internal adoption drivers accelerates the S-curve."
                },
                {
                                "id": 3,
                                "question": "What is a direct network effect in platform economics?",
                                "options": {
                                                "A": "The platform's value increases as it directly invests in infrastructure",
                                                "B": "Each additional user increases the platform's value for other users of the same type",
                                                "C": "The platform generates revenue directly from transaction fees",
                                                "D": "Users can directly contact the platform support team"
                                },
                                "correct": "B",
                                "explanation": "Direct network effects occur when value increases with same-side adoption. Examples include social networks where more users mean more connections, or payment networks where more users mean wider acceptance."
                },
                {
                                "id": 4,
                                "question": "What distinguishes indirect network effects from direct ones?",
                                "options": {
                                                "A": "Indirect effects are weaker and can be ignored in platform design",
                                                "B": "Indirect effects occur between different user groups (e.g., buyers and sellers)",
                                                "C": "Indirect effects only apply to blockchain platforms",
                                                "D": "Indirect effects decrease as the platform grows"
                                },
                                "correct": "B",
                                "explanation": "Indirect (cross-side) network effects arise in two-sided markets where value for one group depends on participation of another group. Examples include marketplaces (buyers-sellers) or app stores (users-developers)."
                },
                {
                                "id": 5,
                                "question": "In the critical mass model, what is the unstable equilibrium?",
                                "options": {
                                                "A": "The point where adoption cost equals adoption benefit",
                                                "B": "The threshold below which the platform collapses and above which it grows rapidly",
                                                "C": "The maximum sustainable adoption rate",
                                                "D": "The inflection point of the S-curve"
                                },
                                "correct": "B",
                                "explanation": "The unstable equilibrium (shown as dashed red line) is the critical mass threshold. Below it, the platform tends toward zero adoption; above it, positive feedback drives growth toward full adoption. It separates two stable equilibria."
                },
                {
                                "id": 6,
                                "question": "According to the bifurcation diagram, what happens when adoption cost (c) is very low?",
                                "options": {
                                                "A": "Multiple equilibria exist with path dependence",
                                                "B": "Only the high-adoption stable equilibrium exists",
                                                "C": "The platform cannot sustain any users",
                                                "D": "Adoption becomes chaotic and unpredictable"
                                },
                                "correct": "B",
                                "explanation": "At low adoption costs, the benefit threshold is easily met, leading to a single high stable equilibrium. As costs increase past the critical threshold (~0.25 in the model), multiple equilibria emerge with a coordination problem."
                },
                {
                                "id": 7,
                                "question": "What defines a 'winner-take-all' market structure?",
                                "options": {
                                                "A": "Legal monopolies enforced by government regulation",
                                                "B": "Strong network effects and low multi-homing costs leading to market concentration",
                                                "C": "First-mover advantage that cannot be overcome",
                                                "D": "Markets where only one company is profitable"
                                },
                                "correct": "B",
                                "explanation": "Winner-take-all dynamics emerge from strong network effects combined with high switching costs and low multi-homing benefits. Early leads get amplified through positive feedback, as shown in the Polya urn simulation where initial advantages compound."
                },
                {
                                "id": 8,
                                "question": "The Polya urn model demonstrates which key property of platform competition?",
                                "options": {
                                                "A": "Platforms eventually reach equal market share through competition",
                                                "B": "Path dependence: small early advantages can determine long-run outcomes",
                                                "C": "New entrants always overcome incumbents through innovation",
                                                "D": "Market share is determined solely by product quality"
                                },
                                "correct": "B",
                                "explanation": "The Polya urn shows increasing returns to adoption: probability of gaining users is proportional to current size (counts + 1). Different random seeds produce vastly different final market shares, demonstrating path dependence and lock-in effects."
                },
                {
                                "id": 9,
                                "question": "What is a utility token's primary function?",
                                "options": {
                                                "A": "Representing ownership shares in the protocol",
                                                "B": "Providing access to or payment for platform services",
                                                "C": "Securing the blockchain through proof-of-work",
                                                "D": "Distributing profits to token holders"
                                },
                                "correct": "B",
                                "explanation": "Utility tokens grant access to platform functionality or serve as medium of exchange within the ecosystem. Examples include paying for cloud storage, gas fees, or accessing premium features. They differ from governance and security tokens."
                },
                {
                                "id": 10,
                                "question": "What distinguishes governance tokens from utility tokens?",
                                "options": {
                                                "A": "Governance tokens have unlimited supply, utility tokens are capped",
                                                "B": "Governance tokens grant voting rights on protocol decisions",
                                                "C": "Governance tokens cannot be traded on exchanges",
                                                "D": "Governance tokens are always more valuable"
                                },
                                "correct": "B",
                                "explanation": "Governance tokens enable decentralized decision-making by granting voting rights on protocol upgrades, parameter changes, and treasury allocation. They may also carry utility features, but their core function is protocol governance."
                },
                {
                                "id": 11,
                                "question": "According to the equation of exchange (M*V = P*Q), what is token velocity (V)?",
                                "options": {
                                                "A": "The speed at which new tokens are minted",
                                                "B": "The number of times a token changes hands per period",
                                                "C": "The volatility of the token price",
                                                "D": "The rate at which tokens are burned"
                                },
                                "correct": "B",
                                "explanation": "Velocity measures transaction frequency: how often each token is used. High velocity means tokens circulate quickly, lowering market cap for given transaction volume (M = PQ/V). Low velocity from holding/staking increases value capture."
                },
                {
                                "id": 12,
                                "question": "In the velocity model, what is the effect of staking 50% of tokens?",
                                "options": {
                                                "A": "It reduces velocity by half, doubling the potential market cap",
                                                "B": "It has no effect on market cap since staked tokens still exist",
                                                "C": "It increases velocity as stakers earn more rewards to spend",
                                                "D": "It reduces the transaction volume (PQ) by half"
                                },
                                "correct": "A",
                                "explanation": "Staking creates a 'velocity sink' by removing tokens from circulation. If 50% of tokens are locked, effective velocity is halved, which doubles market cap for the same transaction volume (M = PQ/V). This is shown by the gap between the two curves."
                },
                {
                                "id": 13,
                                "question": "What is Bitcoin's maximum supply cap?",
                                "options": {
                                                "A": "18 million BTC",
                                                "B": "21 million BTC",
                                                "C": "100 million BTC",
                                                "D": "Unlimited with halving reducing inflation over time"
                                },
                                "correct": "B",
                                "explanation": "Bitcoin has a hard cap of 21 million coins enforced by its protocol. New supply comes from block rewards that halve every 4 years (starting at 50 BTC, now 6.25 BTC), creating a deflationary issuance schedule approaching the cap asymptotically."
                },
                {
                                "id": 14,
                                "question": "How does Bitcoin's halving mechanism affect its supply schedule?",
                                "options": {
                                                "A": "Supply is cut in half every 4 years",
                                                "B": "Block rewards are cut in half every 4 years, gradually approaching the 21M cap",
                                                "C": "Mining difficulty is halved every 4 years",
                                                "D": "Transaction fees are halved every 4 years"
                                },
                                "correct": "B",
                                "explanation": "Bitcoin's block reward halves every 210,000 blocks (~4 years): 50→25→12.5→6.25→3.125 BTC. This controls inflation rate while approaching the 21M cap. The chart shows halvings as vertical dotted lines with diminishing new supply."
                },
                {
                                "id": 15,
                                "question": "What characterizes an inflationary token model?",
                                "options": {
                                                "A": "Fixed supply with no new issuance",
                                                "B": "Continuous or increasing token issuance that grows supply over time",
                                                "C": "Supply decreases each year through burns",
                                                "D": "Supply increases only when transaction volume increases"
                                },
                                "correct": "B",
                                "explanation": "Inflationary models continuously issue new tokens (e.g., +5% annually shown in red). This can fund development, reward validators, or incentivize participation, but may pressure price if demand doesn't match new supply."
                },
                {
                                "id": 16,
                                "question": "What is Ethereum's current supply trend after the Merge and EIP-1559?",
                                "options": {
                                                "A": "Highly inflationary with 5%+ annual growth",
                                                "B": "Fixed cap like Bitcoin",
                                                "C": "Net deflationary with burns exceeding issuance",
                                                "D": "Zero inflation with perfectly balanced issuance and burns"
                                },
                                "correct": "C",
                                "explanation": "Post-Merge Ethereum has ~0.5M ETH/year issuance (PoS rewards) but ~0.8M burned (EIP-1559 base fee burns), resulting in net -0.3M/year deflation. The blue line shows declining supply, unlike Bitcoin's capped growth or pure inflationary models."
                },
                {
                                "id": 17,
                                "question": "What is the primary purpose of token staking mechanisms?",
                                "options": {
                                                "A": "Increase transaction speed",
                                                "B": "Reduce effective velocity and align long-term holder incentives",
                                                "C": "Eliminate the need for miners",
                                                "D": "Guarantee token price appreciation"
                                },
                                "correct": "B",
                                "explanation": "Staking locks tokens for rewards, creating a velocity sink that increases market cap (M=PQ/V with lower V). It also aligns incentives by rewarding long-term holders and gives them governance rights, reducing sell pressure."
                },
                {
                                "id": 18,
                                "question": "How do token burns affect the supply schedule?",
                                "options": {
                                                "A": "They increase velocity by removing tokens from circulation",
                                                "B": "They reduce circulating supply, potentially increasing scarcity and per-token value",
                                                "C": "They have no effect since burned tokens can be recovered",
                                                "D": "They only affect transaction fees, not market cap"
                                },
                                "correct": "B",
                                "explanation": "Token burns permanently remove supply, shifting from inflationary to deflationary (-2%/year in green curve). With constant or growing demand, reduced supply increases scarcity. Combined with fee burns (like EIP-1559), this can create net deflation."
                },
                {
                                "id": 19,
                                "question": "What drives winner-take-all outcomes in DeFi protocol competition?",
                                "options": {
                                                "A": "Patents and intellectual property protection",
                                                "B": "Network effects from liquidity concentration and composability",
                                                "C": "Government licensing requirements",
                                                "D": "First protocols always maintain their lead"
                                },
                                "correct": "B",
                                "explanation": "DeFi exhibits path dependence through liquidity network effects (deeper liquidity attracts more traders), composability (protocols integrate with market leaders), and capital efficiency. The Polya urn model shows how early advantages compound through increasing returns."
                },
                {
                                "id": 20,
                                "question": "According to the path dependence simulations, what determines final market structure?",
                                "options": {
                                                "A": "Only the quality of the platform matters",
                                                "B": "Early random events can have lasting effects on which platform dominates",
                                                "C": "The platform with the lowest prices always wins",
                                                "D": "Market shares always converge to equal distribution"
                                },
                                "correct": "B",
                                "explanation": "The inset showing different random seeds demonstrates that identical platforms can reach vastly different market shares based on early adoption patterns. This path dependence means small initial advantages (luck, timing, marketing) can determine long-run winners through positive feedback loops."
                }
]
        };

        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            displayedQuestions: [],
            pendingSlots: []
        };

        const questionsRow = document.getElementById('questionsRow');
        const progressBar = document.getElementById('progressBar');
        const progressBadge = document.getElementById('progressBadge');
        const scoreBadge = document.getElementById('scoreBadge');
        const resultsCard = document.getElementById('resultsCard');
        const nextBtn = document.getElementById('nextBtn');

        function initQuiz() {
            state.currentIndex = 0;
            state.answers = {};
            state.score = 0;
            state.displayedQuestions = [];
            state.pendingSlots = [];

            resultsCard.classList.remove('show');
            questionsRow.style.display = 'grid';
            nextBtn.classList.remove('show');

            // Show first 3 questions
            for (let i = 0; i < 3 && i < quizData.questions.length; i++) {
                state.displayedQuestions.push(i);
            }
            state.currentIndex = Math.min(3, quizData.questions.length);

            renderQuestions();
            updateStats();
        }

        function renderQuestions() {
            questionsRow.innerHTML = '';

            state.displayedQuestions.forEach((qIdx, slot) => {
                const q = quizData.questions[qIdx];
                const answered = state.answers[q.id] !== undefined;
                const isCorrect = answered && state.answers[q.id] === q.correct;
                const isIncorrect = answered && state.answers[q.id] !== q.correct;

                const card = document.createElement('div');
                card.className = 'question-card';
                if (isCorrect) card.classList.add('correct-card', 'answered');
                if (isIncorrect) card.classList.add('incorrect-card', 'answered');

                card.innerHTML = `
                    <div class="q-header">
                        <span class="q-number">Q${qIdx + 1}</span>
                        ${answered ? `<span class="q-status">${isCorrect ? '&#10004;' : '&#10008;'}</span>` : ''}
                    </div>
                    <div class="q-text">${q.question}</div>
                    <div class="options" data-qid="${q.id}" data-slot="${slot}">
                        ${['A','B','C','D'].map(letter => {
                            let optClass = 'option-btn';
                            if (answered) {
                                optClass += ' disabled';
                                if (letter === q.correct) optClass += ' correct';
                                else if (letter === state.answers[q.id]) optClass += ' incorrect';
                            }
                            return `
                                <button class="${optClass}" data-letter="${letter}" ${answered ? 'disabled' : ''}>
                                    <span class="option-letter">${letter}</span>
                                    <span class="option-text">${q.options[letter]}</span>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    <div class="feedback ${answered ? 'show' : ''} ${isCorrect ? 'correct' : 'incorrect'}">
                        ${answered ? (isCorrect ? '&#10004; ' : `&#10008; Answer: ${q.correct}. `) + q.explanation : ''}
                    </div>
                `;

                // Add click handlers
                if (!answered) {
                    card.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => handleAnswer(qIdx, slot, btn.dataset.letter));
                    });
                }

                questionsRow.appendChild(card);
            });

            renderMath();
        }

        function handleAnswer(qIdx, slot, letter) {
            const q = quizData.questions[qIdx];
            state.answers[q.id] = letter;

            if (letter === q.correct) state.score++;

            // Track this slot as pending replacement
            if (!state.pendingSlots.includes(slot)) {
                state.pendingSlots.push(slot);
            }

            updateStats();
            renderQuestions();

            // Check if all questions answered
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                // Short delay then show results
                setTimeout(showResults, 800);
            } else if (state.currentIndex < quizData.questions.length && state.pendingSlots.length > 0) {
                // Show Next button if there are more questions and pending slots
                nextBtn.classList.add('show');
            }
        }

        function loadNextQuestions() {
            // Replace pending slots with new questions
            while (state.pendingSlots.length > 0 && state.currentIndex < quizData.questions.length) {
                const slot = state.pendingSlots.shift();
                state.displayedQuestions[slot] = state.currentIndex;
                state.currentIndex++;
            }

            // Hide Next button
            nextBtn.classList.remove('show');

            renderQuestions();

            // Check if quiz is complete (all displayed questions answered)
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                setTimeout(showResults, 500);
            }
        }

        function updateStats() {
            const answered = Object.keys(state.answers).length;
            const total = quizData.questions.length;

            progressBar.style.width = `${(answered / total) * 100}%`;
            progressBadge.textContent = `${answered}/${total}`;
            scoreBadge.textContent = `Score: ${state.score}`;
        }

        function showResults() {
            questionsRow.style.display = 'none';
            nextBtn.classList.remove('show');
            resultsCard.classList.add('show');

            const total = quizData.questions.length;
            const percentage = Math.round((state.score / total) * 100);

            document.getElementById('resultsScore').textContent = `${state.score}/${total}`;

            let grade, gradeClass, icon;
            if (percentage >= 90) { grade = 'Excellent! A'; gradeClass = 'grade-a'; icon = '&#127942;'; }
            else if (percentage >= 80) { grade = 'Great! B'; gradeClass = 'grade-b'; icon = '&#11088;'; }
            else if (percentage >= 70) { grade = 'Good! C'; gradeClass = 'grade-c'; icon = '&#128077;'; }
            else if (percentage >= 60) { grade = 'Pass - D'; gradeClass = 'grade-d'; icon = '&#128221;'; }
            else { grade = 'Keep practicing'; gradeClass = 'grade-f'; icon = '&#128218;'; }

            document.getElementById('resultsIcon').innerHTML = icon;
            const gradeEl = document.getElementById('resultsGrade');
            gradeEl.textContent = `${grade} (${percentage}%)`;
            gradeEl.className = `results-grade ${gradeClass}`;
        }

        function restartQuiz() {
            initQuiz();
        }

        function renderMath() {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initQuiz();
            setTimeout(renderMath, 100);
        });
    </script>
</body>
</html>
