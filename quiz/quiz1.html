<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: L01 Introduction | Digital Finance & Economics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        :root {
            --mlpurple: #3333B2;
            --mlblue: #0066CC;
            --quiz-accent: #8b5cf6;
            --quiz-light: #ede9fe;
            --correct: #22c55e;
            --correct-bg: #dcfce7;
            --incorrect: #ef4444;
            --incorrect-bg: #fee2e2;
            --bg: #f6f8fa;
            --card-bg: #ffffff;
            --text: #24292e;
            --text-secondary: #586069;
            --border: #e1e4e8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
            min-height: 100vh;
        }

        .nav {
            background: linear-gradient(135deg, var(--mlpurple), var(--mlblue));
            color: white;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-title { font-weight: 600; font-size: 14px; }
        .nav-links { display: flex; gap: 16px; }
        .nav-links a { color: white; text-decoration: none; font-size: 12px; opacity: 0.9; }
        .nav-links a:hover { opacity: 1; }

        .quiz-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 0 4px;
        }
        .quiz-title { font-size: 16px; font-weight: 600; color: var(--mlpurple); }
        .quiz-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
        }
        .stat-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        .stat-progress { background: var(--quiz-light); color: var(--quiz-accent); }
        .stat-score { background: var(--correct-bg); color: var(--correct); }

        .progress-bar-container {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-bottom: 12px;
        }
        .progress-bar {
            height: 100%;
            background: var(--quiz-accent);
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Three-column layout */
        .questions-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 12px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            min-height: 280px;
        }

        .question-card.answered { opacity: 0.7; }

        .question-card.correct-card {
            border: 2px solid var(--correct);
            background: linear-gradient(to bottom, var(--correct-bg), var(--card-bg));
        }

        .question-card.incorrect-card {
            border: 2px solid var(--incorrect);
            background: linear-gradient(to bottom, var(--incorrect-bg), var(--card-bg));
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .q-number {
            background: var(--quiz-light);
            color: var(--quiz-accent);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .q-status { font-size: 14px; }

        .q-text {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-grow: 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-grow: 1;
        }

        .option-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            min-height: 44px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--card-bg);
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            font-size: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--quiz-accent);
            background: var(--quiz-light);
        }

        .option-btn.correct {
            border-color: var(--correct);
            background: var(--correct-bg);
        }

        .option-btn.incorrect {
            border-color: var(--incorrect);
            background: var(--incorrect-bg);
        }

        .option-btn.disabled { cursor: default; }

        .option-letter {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 10px;
            flex-shrink: 0;
        }

        .option-btn.correct .option-letter {
            background: var(--correct);
            color: white;
        }

        .option-btn.incorrect .option-letter {
            background: var(--incorrect);
            color: white;
        }

        .option-text { flex: 1; }

        .feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            line-height: 1.4;
            display: none;
        }

        .feedback.show { display: block; }
        .feedback.correct { background: var(--correct-bg); color: #166534; }
        .feedback.incorrect { background: var(--incorrect-bg); color: #991b1b; }

        /* Results */
        .results-card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 32px;
            text-align: center;
            max-width: 500px;
            margin: 40px auto;
            display: none;
        }
        .results-card.show { display: block; }
        .results-icon { font-size: 48px; margin-bottom: 8px; }
        .results-score { font-size: 36px; font-weight: 700; color: var(--quiz-accent); }
        .results-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
        .results-grade {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .grade-a { background: #dcfce7; color: #166534; }
        .grade-b { background: #dbeafe; color: #1e40af; }
        .grade-c { background: #fef3c7; color: #92400e; }
        .grade-d { background: #fed7aa; color: #9a3412; }
        .grade-f { background: #fee2e2; color: #991b1b; }

        .results-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        .btn-primary { background: var(--quiz-accent); color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-secondary { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }

        /* Next button container */
        .next-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }
        .btn-next {
            padding: 10px 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: var(--quiz-accent);
            color: white;
            transition: all 0.2s;
            display: none;
        }
        .btn-next:hover { background: #7c3aed; transform: scale(1.02); }
        .btn-next.show { display: inline-block; }
        .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }

        @media (max-width: 900px) {
            .questions-row { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .questions-row { grid-template-columns: 1fr; }
            .question-card { min-height: auto; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-title">Quiz: L01 Introduction</div>
        <div class="nav-links">
            <a href="../index.html">Dashboard</a>
            
            <a href="https://github.com/Digital-AI-Finance/digital-finance-economics" target="_blank">GitHub</a>
        </div>
    </nav>

    <main class="quiz-container">
        <div class="quiz-header">
            <div class="quiz-title">Quiz: L01 Introduction</div>
            <div class="quiz-stats">
                <span class="stat-badge stat-progress" id="progressBadge">0/20</span>
                <span class="stat-badge stat-score" id="scoreBadge">Score: 0</span>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="questions-row" id="questionsRow"></div>

        <div class="next-btn-container">
            <button class="btn-next" id="nextBtn" onclick="loadNextQuestions()">Next</button>
        </div>

        <div class="results-card" id="resultsCard">
            <div class="results-icon" id="resultsIcon"></div>
            <div class="results-score" id="resultsScore"></div>
            <div class="results-label">Correct Answers</div>
            <div class="results-grade" id="resultsGrade"></div>
            <div class="results-buttons">
                <button class="btn btn-primary" onclick="restartQuiz()">Try Again</button>
                <a href="../index.html" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>
    </main>

    <script>
        const quizData = {
            questions: [
                {
                                "id": 1,
                                "question": "According to the course's economic definition, what is a core characteristic of digital finance?",
                                "options": {
                                                "A": "It uses blockchain technology for all transactions",
                                                "B": "It relies on digital infrastructure for value transfer",
                                                "C": "It eliminates all intermediaries from financial services",
                                                "D": "It requires cryptocurrency as the primary medium of exchange"
                                },
                                "correct": "B",
                                "explanation": "The course defines digital finance economically as financial services and instruments that rely on digital infrastructure for value transfer, rather than by specific technologies like blockchain. Options A and D are too narrow, while C is incorrect because digital finance can involve either disintermediation or re-intermediation."
                },
                {
                                "id": 2,
                                "question": "What is the key distinction between technical and economic questions in digital finance?",
                                "options": {
                                                "A": "Technical questions ask 'How does it work?' while economic questions ask 'What incentives drive adoption?'",
                                                "B": "Technical questions focus on regulation while economic questions focus on coding",
                                                "C": "Technical questions are theoretical while economic questions are practical",
                                                "D": "Technical questions study markets while economic questions study algorithms"
                                },
                                "correct": "A",
                                "explanation": "The course explicitly distinguishes technical questions (mechanisms and implementation, 'How does it work?') from economic questions (incentives and welfare, 'What incentives drive adoption?'). This fundamental distinction guides the entire course's analytical approach."
                },
                {
                                "id": 3,
                                "question": "Which of the following is an economic question rather than a technical question about smart contracts?",
                                "options": {
                                                "A": "What programming languages are used to write smart contracts?",
                                                "B": "How do smart contracts execute on the blockchain?",
                                                "C": "How do smart contracts reduce transaction costs?",
                                                "D": "What cryptographic algorithms secure smart contracts?"
                                },
                                "correct": "C",
                                "explanation": "Economic questions focus on incentives and welfare effects. Asking how smart contracts reduce transaction costs addresses economic efficiency and cost-benefit analysis. Options A, B, and D all focus on technical mechanisms and implementation details."
                },
                {
                                "id": 4,
                                "question": "Which of the following is NOT explicitly mentioned in the course's scope of digital finance?",
                                "options": {
                                                "A": "Central Bank Digital Currencies (CBDCs)",
                                                "B": "Decentralized Finance (DeFi)",
                                                "C": "Quantum computing for encryption",
                                                "D": "Tokenized assets"
                                },
                                "correct": "C",
                                "explanation": "The course scope explicitly includes cryptocurrencies, stablecoins, CBDCs, digital payment systems, DeFi, and tokenized assets. Quantum computing for encryption is a technical implementation topic not listed as part of the economic scope of digital finance."
                },
                {
                                "id": 5,
                                "question": "According to the Four Economic Lenses framework, which lens examines how digital currencies affect money supply and monetary policy transmission?",
                                "options": {
                                                "A": "Platform Economics",
                                                "B": "Monetary Economics",
                                                "C": "Market Microstructure",
                                                "D": "Regulatory Economics"
                                },
                                "correct": "B",
                                "explanation": "Monetary Economics (Lens 1) addresses key questions about how digital currencies affect money supply, monetary policy transmission, and whether cryptocurrencies can replace fiat money. This lens applies theoretical tools like the quantity theory of money and money demand functions."
                },
                {
                                "id": 6,
                                "question": "Which economic lens would you apply to understand why some cryptocurrencies dominate and how network effects shape adoption?",
                                "options": {
                                                "A": "Monetary Economics",
                                                "B": "Regulatory Economics",
                                                "C": "Platform Economics",
                                                "D": "Market Microstructure"
                                },
                                "correct": "C",
                                "explanation": "Platform Economics (Lens 2) examines network effects models, critical mass, winner-take-all dynamics, and token value determination. It uses two-sided market theory and mechanism design to understand cryptocurrency adoption patterns and dominance."
                },
                {
                                "id": 7,
                                "question": "The Market Microstructure lens primarily focuses on which aspect of digital finance?",
                                "options": {
                                                "A": "How crypto markets discover prices and why spreads vary",
                                                "B": "How central banks should design digital currencies",
                                                "C": "How tokens create network effects",
                                                "D": "How regulators classify cryptocurrencies"
                                },
                                "correct": "A",
                                "explanation": "Market Microstructure (Lens 3) examines price discovery mechanisms, bid-ask spreads, liquidity provision, and differences between AMMs and order books. It addresses market efficiency questions rather than monetary policy, platform dynamics, or regulatory classification."
                },
                {
                                "id": 8,
                                "question": "Which economic lens would be most appropriate to analyze the rationale for consumer protection in cryptocurrency markets?",
                                "options": {
                                                "A": "Platform Economics",
                                                "B": "Monetary Economics",
                                                "C": "Market Microstructure",
                                                "D": "Regulatory Economics"
                                },
                                "correct": "D",
                                "explanation": "Regulatory Economics (Lens 4) applies market failure analysis to justify regulation, examining asymmetric information, systemic risk externalities, and consumer protection rationales. It evaluates the costs and benefits of different regulatory approaches."
                },
                {
                                "id": 9,
                                "question": "According to the classical functions of money discussed in the course, which function solves the 'double coincidence of wants' problem?",
                                "options": {
                                                "A": "Unit of account",
                                                "B": "Store of value",
                                                "C": "Medium of exchange",
                                                "D": "Legal tender"
                                },
                                "correct": "C",
                                "explanation": "The medium of exchange function solves the double coincidence of wants problem by reducing transaction costs and requiring acceptability. This allows trade to occur without both parties needing to want exactly what the other offers."
                },
                {
                                "id": 10,
                                "question": "Which function of money simplifies price comparisons and enables economic calculation?",
                                "options": {
                                                "A": "Medium of exchange",
                                                "B": "Unit of account",
                                                "C": "Store of value",
                                                "D": "Standard of deferred payment"
                                },
                                "correct": "B",
                                "explanation": "The unit of account function simplifies price comparisons, enables economic calculation, and reduces cognitive costs by providing a common measure of value. This allows economic agents to compare prices efficiently across different goods and services."
                },
                {
                                "id": 11,
                                "question": "What is the primary limitation of Bitcoin as a medium of exchange according to the course?",
                                "options": {
                                                "A": "Insufficient network capacity",
                                                "B": "High transaction fees",
                                                "C": "Price volatility",
                                                "D": "Lack of merchant acceptance"
                                },
                                "correct": "C",
                                "explanation": "The course identifies volatility as Bitcoin's primary limitation as a medium of exchange. While Bitcoin faces other challenges, price volatility directly undermines its ability to serve as a stable medium for transactions, unlike stablecoins which aim to address this issue."
                },
                {
                                "id": 12,
                                "question": "According to Jevons' principle cited in the course, how should we evaluate whether something functions as money?",
                                "options": {
                                                "A": "By its legal tender status",
                                                "B": "By its technological sophistication",
                                                "C": "By its functional performance across the three classical functions",
                                                "D": "By its backing from a central authority"
                                },
                                "correct": "C",
                                "explanation": "Jevons (1875) stated that 'Money is what money does,' meaning we evaluate monetary assets by their functional performance across the three classical functions (medium of exchange, unit of account, store of value), not by legal status or other criteria."
                },
                {
                                "id": 13,
                                "question": "What economic problem does the use of money fundamentally solve in trade?",
                                "options": {
                                                "A": "Information asymmetry",
                                                "B": "Double coincidence of wants",
                                                "C": "Moral hazard",
                                                "D": "Adverse selection"
                                },
                                "correct": "B",
                                "explanation": "Money solves the double coincidence of wants problem, which occurs in barter economies where both parties must simultaneously want what the other offers. Money as a medium of exchange eliminates this requirement and dramatically reduces transaction costs."
                },
                {
                                "id": 14,
                                "question": "In the historical evolution of payment methods, what primary economic force drove each transition according to the course?",
                                "options": {
                                                "A": "Government regulation",
                                                "B": "Technological innovation",
                                                "C": "Reducing transaction costs and enabling trade at scale",
                                                "D": "Increased security requirements"
                                },
                                "correct": "C",
                                "explanation": "The course explicitly states that each transition in payment methods was driven by economic forces: reducing transaction costs and enabling trade at scale. While technology and regulation played roles, the fundamental driver was economic efficiency."
                },
                {
                                "id": 15,
                                "question": "Which concept explains the idea that 'bad money drives out good' in monetary systems?",
                                "options": {
                                                "A": "Nash equilibrium",
                                                "B": "Gresham's Law",
                                                "C": "The quantity theory of money",
                                                "D": "Say's Law"
                                },
                                "correct": "B",
                                "explanation": "Gresham's Law states that 'bad money drives out good,' meaning that when two forms of money are in circulation, people will hoard the more valuable form and spend the less valuable form. This concept is discussed in the Monetary Economics lens as relevant to digital currency competition."
                },
                {
                                "id": 16,
                                "question": "What does 'disintermediation' mean in the context of digital finance?",
                                "options": {
                                                "A": "Adding more intermediaries to financial transactions",
                                                "B": "Government regulation of intermediaries",
                                                "C": "Removal or reduction of traditional intermediaries in financial transactions",
                                                "D": "Changing the technology used by intermediaries"
                                },
                                "correct": "C",
                                "explanation": "Disintermediation refers to the removal or reduction of traditional intermediaries (like banks) in financial transactions. The course notes that digital finance can enable either disintermediation or re-intermediation, making this a key economic characteristic."
                },
                {
                                "id": 17,
                                "question": "Based on the three functions of money, which type of digital currency is explicitly designed to fulfill all three functions?",
                                "options": {
                                                "A": "Bitcoin",
                                                "B": "Stablecoins",
                                                "C": "Central Bank Digital Currencies (CBDCs)",
                                                "D": "Utility tokens"
                                },
                                "correct": "C",
                                "explanation": "The course explicitly states that CBDCs are 'designed to fulfill all three' functions of money (medium of exchange, unit of account, store of value), while Bitcoin is limited as a medium due to volatility, and stablecoins face trust issues despite better stability."
                },
                {
                                "id": 18,
                                "question": "According to the course, stablecoins perform better than Bitcoin as a medium of exchange, but face what primary economic challenge?",
                                "options": {
                                                "A": "Technological scalability",
                                                "B": "Trust issues",
                                                "C": "Network effects",
                                                "D": "Regulatory arbitrage"
                                },
                                "correct": "B",
                                "explanation": "The course states that while stablecoins are 'better' than Bitcoin as a medium of exchange due to lower volatility, they face 'trust issues.' This refers to the need to trust the issuer's backing and redemption mechanisms."
                },
                {
                                "id": 19,
                                "question": "Why should economists study digital finance according to the course's research opportunities argument?",
                                "options": {
                                                "A": "To compete with computer scientists for funding",
                                                "B": "Because digital finance provides high-frequency blockchain data, natural experiments in adoption, and cross-country regulatory variation",
                                                "C": "To create new cryptocurrencies",
                                                "D": "To replace traditional monetary theory"
                                },
                                "correct": "B",
                                "explanation": "The course identifies specific research opportunities: high-frequency blockchain data for empirical analysis, natural experiments in adoption patterns, and cross-country regulatory variation for comparative studies. This makes digital finance a 'laboratory for testing economic theories with real-world data.'"
                },
                {
                                "id": 20,
                                "question": "Which of the following best represents the scale of digital finance transformation mentioned in the course?",
                                "options": {
                                                "A": "Digital payments expected to reach $5 trillion by 2027",
                                                "B": "Digital payments expected to reach $15+ trillion by 2027 and 130+ countries exploring CBDCs",
                                                "C": "50 countries have launched CBDCs",
                                                "D": "Digital payments have replaced 50% of cash transactions globally"
                                },
                                "correct": "B",
                                "explanation": "The course cites '$15+ trillion digital payments by 2027' and '130+ countries exploring CBDCs' as evidence of disruption potential and why economists should study digital finance. COVID-19 accelerated this digital payment adoption trend."
                }
]
        };

        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            displayedQuestions: [],
            pendingSlots: []
        };

        const questionsRow = document.getElementById('questionsRow');
        const progressBar = document.getElementById('progressBar');
        const progressBadge = document.getElementById('progressBadge');
        const scoreBadge = document.getElementById('scoreBadge');
        const resultsCard = document.getElementById('resultsCard');
        const nextBtn = document.getElementById('nextBtn');

        function initQuiz() {
            state.currentIndex = 0;
            state.answers = {};
            state.score = 0;
            state.displayedQuestions = [];
            state.pendingSlots = [];

            resultsCard.classList.remove('show');
            questionsRow.style.display = 'grid';
            nextBtn.classList.remove('show');

            // Show first 3 questions
            for (let i = 0; i < 3 && i < quizData.questions.length; i++) {
                state.displayedQuestions.push(i);
            }
            state.currentIndex = Math.min(3, quizData.questions.length);

            renderQuestions();
            updateStats();
        }

        function renderQuestions() {
            questionsRow.innerHTML = '';

            state.displayedQuestions.forEach((qIdx, slot) => {
                const q = quizData.questions[qIdx];
                const answered = state.answers[q.id] !== undefined;
                const isCorrect = answered && state.answers[q.id] === q.correct;
                const isIncorrect = answered && state.answers[q.id] !== q.correct;

                const card = document.createElement('div');
                card.className = 'question-card';
                if (isCorrect) card.classList.add('correct-card', 'answered');
                if (isIncorrect) card.classList.add('incorrect-card', 'answered');

                card.innerHTML = `
                    <div class="q-header">
                        <span class="q-number">Q${qIdx + 1}</span>
                        ${answered ? `<span class="q-status">${isCorrect ? '&#10004;' : '&#10008;'}</span>` : ''}
                    </div>
                    <div class="q-text">${q.question}</div>
                    <div class="options" data-qid="${q.id}" data-slot="${slot}">
                        ${['A','B','C','D'].map(letter => {
                            let optClass = 'option-btn';
                            if (answered) {
                                optClass += ' disabled';
                                if (letter === q.correct) optClass += ' correct';
                                else if (letter === state.answers[q.id]) optClass += ' incorrect';
                            }
                            return `
                                <button class="${optClass}" data-letter="${letter}" ${answered ? 'disabled' : ''}>
                                    <span class="option-letter">${letter}</span>
                                    <span class="option-text">${q.options[letter]}</span>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    <div class="feedback ${answered ? 'show' : ''} ${isCorrect ? 'correct' : 'incorrect'}">
                        ${answered ? (isCorrect ? '&#10004; ' : `&#10008; Answer: ${q.correct}. `) + q.explanation : ''}
                    </div>
                `;

                // Add click handlers
                if (!answered) {
                    card.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => handleAnswer(qIdx, slot, btn.dataset.letter));
                    });
                }

                questionsRow.appendChild(card);
            });

            renderMath();
        }

        function handleAnswer(qIdx, slot, letter) {
            const q = quizData.questions[qIdx];
            state.answers[q.id] = letter;

            if (letter === q.correct) state.score++;

            // Track this slot as pending replacement
            if (!state.pendingSlots.includes(slot)) {
                state.pendingSlots.push(slot);
            }

            updateStats();
            renderQuestions();

            // Check if all questions answered
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                // Short delay then show results
                setTimeout(showResults, 800);
            } else if (state.currentIndex < quizData.questions.length && state.pendingSlots.length > 0) {
                // Show Next button if there are more questions and pending slots
                nextBtn.classList.add('show');
            }
        }

        function loadNextQuestions() {
            // Replace pending slots with new questions
            while (state.pendingSlots.length > 0 && state.currentIndex < quizData.questions.length) {
                const slot = state.pendingSlots.shift();
                state.displayedQuestions[slot] = state.currentIndex;
                state.currentIndex++;
            }

            // Hide Next button
            nextBtn.classList.remove('show');

            renderQuestions();

            // Check if quiz is complete (all displayed questions answered)
            const answered = Object.keys(state.answers).length;
            if (answered >= quizData.questions.length) {
                setTimeout(showResults, 500);
            }
        }

        function updateStats() {
            const answered = Object.keys(state.answers).length;
            const total = quizData.questions.length;

            progressBar.style.width = `${(answered / total) * 100}%`;
            progressBadge.textContent = `${answered}/${total}`;
            scoreBadge.textContent = `Score: ${state.score}`;
        }

        function showResults() {
            questionsRow.style.display = 'none';
            nextBtn.classList.remove('show');
            resultsCard.classList.add('show');

            const total = quizData.questions.length;
            const percentage = Math.round((state.score / total) * 100);

            document.getElementById('resultsScore').textContent = `${state.score}/${total}`;

            let grade, gradeClass, icon;
            if (percentage >= 90) { grade = 'Excellent! A'; gradeClass = 'grade-a'; icon = '&#127942;'; }
            else if (percentage >= 80) { grade = 'Great! B'; gradeClass = 'grade-b'; icon = '&#11088;'; }
            else if (percentage >= 70) { grade = 'Good! C'; gradeClass = 'grade-c'; icon = '&#128077;'; }
            else if (percentage >= 60) { grade = 'Pass - D'; gradeClass = 'grade-d'; icon = '&#128221;'; }
            else { grade = 'Keep practicing'; gradeClass = 'grade-f'; icon = '&#128218;'; }

            document.getElementById('resultsIcon').innerHTML = icon;
            const gradeEl = document.getElementById('resultsGrade');
            gradeEl.textContent = `${grade} (${percentage}%)`;
            gradeEl.className = `results-grade ${gradeClass}`;
        }

        function restartQuiz() {
            initQuiz();
        }

        function renderMath() {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initQuiz();
            setTimeout(renderMath, 100);
        });
    </script>
</body>
</html>
